---
title: "WebSocket Subscriptions"
---

After authenticating your WebSocket connection, subscribe to topics to receive real-time data. AGG uses a colon-separated topic model with two granularity levels.

## Topic Model

| Topic Pattern | Granularity | Data | Use Case |
|--------------|-------------|------|----------|
| `match:{id}` | Single match | Full detail — scores, incidents, stats, weather, stream status | Match detail page |
| `matches:live` | All live matches | Lightweight — score changes, status changes, match added/removed | Live dashboard |
| `matches:league:{id}` | League matches | Lightweight — same as above, scoped to one league | League view |
| `matches:sport:{id}` | Sport matches | Lightweight — same as above, scoped to one sport | Sport overview |

<Info>
**Singular `match` vs plural `matches`:** The naming signals data granularity. `match:{id}` gives you everything for one match. `matches:*` gives you lightweight list updates for a group.
</Info>

## Instance Topics: `match:{id}`

Subscribe to a specific match to receive **all event types** — scores, incidents (goals, cards, substitutions), statistics updates, weather changes, and stream status changes.

### Subscribe

```json
{
  "type": "subscribe",
  "topic": "match:prov-60154495"
}
```

### Events You Receive

<Tabs>
  <Tab title="score_update">
```json
{
  "type": "score_update",
  "home_score": 2,
  "away_score": 1,
  "last_scorer": "home",
  "timestamp": "2026-02-25T15:45:10Z"
}
```
  </Tab>
  <Tab title="incident">
```json
{
  "type": "incident",
  "data": {
    "incident_type": "goal",
    "minute": 67,
    "player_name": "M. Salah",
    "team": "home",
    "score_snapshot": { "home": 2, "away": 1 }
  },
  "timestamp": "2026-02-25T15:45:10Z"
}
```
  </Tab>
  <Tab title="statistics_update">
```json
{
  "type": "statistics_update",
  "data": {
    "possession": { "home": 58, "away": 42 },
    "shots_on_target": { "home": 7, "away": 3 }
  },
  "timestamp": "2026-02-25T15:45:00Z"
}
```
  </Tab>
  <Tab title="weather_update">
```json
{
  "type": "weather_update",
  "data": {
    "condition": "Rainy",
    "temperature": 12,
    "humidity": 85,
    "wind_speed": 18,
    "wind_direction": "SW",
    "pressure": 1008
  },
  "timestamp": "2026-02-25T15:50:00Z"
}
```
  </Tab>
  <Tab title="stream_update">
```json
{
  "type": "stream_update",
  "data": {
    "stream_id": "s1",
    "is_live": true,
    "signal_on": true
  },
  "timestamp": "2026-02-25T15:45:00Z"
}
```
  </Tab>
</Tabs>

## Category Topics: `matches:*`

Subscribe to a group of matches to receive **lightweight list updates** — score changes, status changes, and matches entering/leaving the group.

### Subscribe

<Tabs>
  <Tab title="All Live Matches">
```json
{
  "type": "subscribe",
  "topic": "matches:live"
}
```
  </Tab>
  <Tab title="By League">
```json
{
  "type": "subscribe",
  "topic": "matches:league:39"
}
```
  </Tab>
  <Tab title="By Sport">
```json
{
  "type": "subscribe",
  "topic": "matches:sport:1"
}
```
  </Tab>
</Tabs>

### Events You Receive

<Tabs>
  <Tab title="score_update">
```json
{
  "type": "score_update",
  "match_id": "prov-60154495",
  "home_score": 2,
  "away_score": 1,
  "timestamp": "2026-02-25T15:45:10Z"
}
```
  </Tab>
  <Tab title="status_update">
```json
{
  "type": "status_update",
  "match_id": "prov-60154495",
  "status": "live",
  "game_stage": "2H",
  "timestamp": "2026-02-25T15:15:00Z"
}
```
  </Tab>
  <Tab title="match_added">
```json
{
  "type": "match_added",
  "match_id": "prov-60154800",
  "data": {
    "home_team": "Arsenal",
    "away_team": "Chelsea",
    "league_name": "Premier League",
    "status": "live"
  },
  "timestamp": "2026-02-25T16:00:00Z"
}
```
  </Tab>
  <Tab title="match_removed">
```json
{
  "type": "match_removed",
  "match_id": "prov-60154495",
  "reason": "completed",
  "timestamp": "2026-02-25T16:45:00Z"
}
```
  </Tab>
</Tabs>

<Warning>
Category topics send lightweight payloads only — no incidents, statistics, weather, or stream details. Subscribe to `match:{id}` when you need full event data for a specific match.
</Warning>

## Subscribe / Unsubscribe Messages

### Subscribe Success

```json
{
  "type": "subscribe_success",
  "topic": "match:prov-60154495",
  "message": "Subscribed to match:prov-60154495"
}
```

### Subscribe Error

```json
{
  "type": "subscribe_error",
  "topic": "match:99999999",
  "code": 404,
  "message": "Match not found"
}
```

### Unsubscribe Request

```json
{
  "type": "unsubscribe",
  "topic": "match:prov-60154495"
}
```

### Unsubscribe Success

```json
{
  "type": "unsubscribe_success",
  "topic": "match:prov-60154495",
  "message": "Unsubscribed from match:prov-60154495"
}
```

## Subscription Limits

- Maximum **100 active subscriptions** per WebSocket connection
- Maximum **50 concurrent WebSocket connections** per merchant
- Exceeding limits returns a `subscribe_error` with code `429`

<Warning>
Exceeding subscription limits will not disconnect you, but new subscriptions will be rejected until you unsubscribe from existing ones.
</Warning>

## Recommended Client Flow

<Steps>
  <Step title="Load match list">
    `GET /matches?status=live` — render match cards
  </Step>
  <Step title="Subscribe to live updates">
    `subscribe "matches:live"` — keep the list updated in real-time
  </Step>
  <Step title="User clicks a match">
    `GET /matches/prov-60154495` — render match detail page
  </Step>
  <Step title="Subscribe to match detail">
    `subscribe "match:prov-60154495"` — receive incidents, stats, stream changes
  </Step>
  <Step title="User leaves match detail">
    `unsubscribe "match:prov-60154495"` — clean up to stay within limits
  </Step>
</Steps>

## Cleanup Patterns

Keep subscriptions tidy to stay within limits:

- **On navigate away:** Unsubscribe from `match:{id}` when the user leaves a match detail page
- **On match finish:** The server sends `match_removed` on category topics when a match completes — no action needed. For `match:{id}`, unsubscribe when you receive a `status_update` with `status: "completed"`
- **On disconnect:** All subscriptions are automatically cleared — re-subscribe after reconnecting

```javascript
// Track which match the user is viewing
let activeMatchId = null;

// Cleanup on match finish
function handleEvent(msg) {
  if (msg.type === 'status_update' && msg.status === 'completed' && activeMatchId) {
    ws.send(JSON.stringify({ type: 'unsubscribe', topic: `match:${activeMatchId}` }));
    activeMatchId = null;
  }
}

// Cleanup on navigation
function onLeaveMatchPage() {
  if (activeMatchId) {
    ws.send(JSON.stringify({ type: 'unsubscribe', topic: `match:${activeMatchId}` }));
    activeMatchId = null;
  }
}
```

## Related Pages

<CardGroup cols={2}>
  <Card title="WebSocket Overview" icon="wifi" href="/websocket">
    Topic model, lifecycle, and complete working example
  </Card>
  <Card title="Connection Guide" icon="plug" href="/websocket-connection">
    Auth, heartbeat, and reconnect patterns
  </Card>
  <Card title="Event Payloads" icon="message" href="/websocket-events">
    Detailed payloads for each event type
  </Card>
  <Card title="Troubleshooting" icon="wrench" href="/guides/troubleshooting#websocket-issues">
    Common WebSocket issues and fixes
  </Card>
</CardGroup>
